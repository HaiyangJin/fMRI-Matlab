Notes by Haiyang:

The functions in this folder is from [here](https://github.com/ThomasYeoLab/CBIG/tree/master/stable_projects/registration/Wu2017_RegistrationFusion/bin/scripts_final_proj). Please cite:
Wu, J., Ngo, G. H., Greve, D., Li, J., He, T., Fischl, B., … Yeo, B. T. T. (2018). Accurate nonlinear mapping between MNI volumetric and FreeSurfer surface coordinate systems. Human Brain Mapping, 39(9), 3793–3808. https://doi.org/10.1002/hbm.24213

More see [here](https://github.com/ThomasYeoLab/CBIG/tree/master/stable_projects/registration/Wu2017_RegistrationFusion/bin/scripts_final_proj) or below:

---

## Registration Fusion (RF) Final Projection

Scripts in this folder projects new data using mapping generated by RF approach.

Note that there are 2 variants of RF approach, RF-M3Z and RF-ANTs. RF-M3Z is recommended if data was registered from subject's space to the volumetric atlas space using FreeSurfer. RF-ANTs is recommended if such registrations were carried out using other tools, especially ANTs.

----

## Projecting a Single Input in Matlab

Use the following commands in Matlab to project an input from a volumetric atlas space to fsaverage or from fsaverage to a volumetric atlas space.

- from volumetric atlas space to fsaverage: `[lh_proj_data, rh_proj_data] = CBIG_RF_projectVol2fsaverage_single(path_to_input, interpolation, path_to_lh_map, path_to_rh_map)`

- from fsaverage to volumetric atlas space: `[projected, projected_seg] = CBIG_RF_projectfsaverage2Vol_single(lh_input_array, rh_input_array, interpolation, path_to_mapping, path_to_mask)`

----

## Projecting a Batch of Inputs

Use the following commands to project a list of inputs from a volumetric atlas space to fsaverage or from fsaverage to a volumetric atlas space.

**For Volume-to-fsaverage projection, each line in my_input_list should contain one file name. Note that inputs should be in the format of .nii or .nii.gz**

- MNI152-to-fsaverage

RF-ANTs: `./CBIG_RF_projectVol2fsaverage_batch.sh -l my_input_list.csv`

RF-M3Z: `./CBIG_RF_projectVol2fsaverage_batch.sh -l my_input_list.csv -r RF_M3Z -p MNI152_norm`

- Colin27-to-fsaverage

RF-ANTs: `./CBIG_RF_projectVol2fsaverage_batch.sh -l my_input_list.csv -p Colin27_orig`

RF-M3Z: `./CBIG_RF_projectVol2fsaverage_batch.sh -l my_input_list.csv -p Colin27_norm -r RF_M3Z`

**For fsaverage-to-volume projection, each line in my_input_list should contain one file name. Note that the inputs should be in .mat format, containing two variables `lh_label` and `rh_label`, corresponding to the input data in left and right hemispheres respectively.**

- fsaverage-to-MNI152

RF-ANTs: `./CBIG_RF_projectfsaverage2Vol_batch.sh -l my_input_list.csv`

RF-M3Z:  `./CBIG_RF_projectfsaverage2Vol_batch.sh -l my_input_list.csv -r RF_M3Z`

- fsaverage-to-Colin27

RF-ANTs: `PARENT_PATH=$(dirname "$(readlink -f "$(pwd)")")` then `./CBIG_RF_projectfsaverage2Vol_batch.sh -l my_input_list.csv -s SPM_Colin27_FS4.5.0 -m $PARENT_PATH/liberal_cortex_masks_FS5.3/SPM_Colin27_FS4.5.0_cortex_estimate.nii.gz`

RF-M3Z: `PARENT_PATH=$(dirname "$(readlink -f "$(pwd)")")` then `./CBIG_RF_projectfsaverage2Vol_batch.sh -r RF_M3Z -l my_input_list.csv -s SPM_Colin27_FS4.5.0 -m $PARENT_PATH/liberal_cortex_masks_FS5.3/SPM_Colin27_FS4.5.0_cortex_estimate.nii.gz`
